<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <title>Fish demo</title>
    <meta name="description" content="MR.js project">
    <script src="https://cdn.jsdelivr.net/npm/mrjs@latest/dist/mr.js"></script>
    <link rel="stylesheet" type="text/css" href="style.css" />
    <meta name="viewport" content="width=device-width, initial-scale=1">
</head>

<body>
    <mr-app debug="true">
        <mr-panel class="layout">

            <mr-div class="nav">
                <mr-button onclick="App.prev()">Next</mr-button>
                <mr-button style="margin-left: auto;" onclick="App.next()">Prev</mr-button>
            </mr-div>

            <mr-div id="models"></mr-div>

            <mr-div class="information">
                <mr-text id="name"></mr-text>
                <mr-text id="desc"></mr-text>
            </mr-div>

            <mr-light color="hsl(100, 100%, 100%)" intensity="1" data-position="0 1 1"></mr-light>

        </mr-panel>
    </mr-app>

    <script>
        var __appState = {
            fishes: [
                {
                    name: "Koi fish",
                    model: 'koifish.glb',
                    scale: 0.05,
                    desc: "Nibh euismod cursus pharetra sit sem ut incididunt cursus in."
                },
                {
                    name: "Cube fish",
                    model: 'cube.glb',
                    scale: 0.1,
                    desc: "Dictumst proin pharetra vestibulum aliqua lectus elit labore cursus dolore."
                },
                {
                    name: "Whale",
                    model: 'cube.glb',
                    scale: 0.1,
                    desc: "Pellentesque ut elit labore adipiscing mi amet ut eiusmod ut."
                },
                {
                    name: "Chicken",
                    model: 'koifish.glb',
                    scale: 0.08,
                    desc: "Hendrerit a elit tortor euismod do sed enim ipsum enim."
                }
            ],
            selected: 0,
            next: function () {
                if (this.selected < this.fishes.length - 1) {
                    this.selected++
                }
            },
            prev: function () {
                if (this.selected > 0) {
                    this.selected--
                }
            },
            render: function () {
                let selectedFish = this.fishes[this.selected];

                document.querySelector("#name").innerText = selectedFish.name;
                document.querySelector("#desc").innerText = selectedFish.desc;

                let childArray = Array.from(document.querySelector("#models").childNodes);

                // Hide all the fishes but the selected one
                childArray.forEach(child => {
                    if (child.dataset.name == App.fishes[App.selected].name) {
                        child.object3D.visible = true;
                    } else {
                        child.object3D.visible = false;
                    }
                });
            }
        }

        // Magic reactivity
        const handler = {
            set(target, property, value) {
                target[property] = value;
                App.render();
                return true;
            }
        };

        // Magic reactivity
        const App = new Proxy(__appState, handler);

        App.fishes.forEach(fish => {
            let model = document.createElement("mr-model");
            model.setAttribute("src", "./assets/" + fish.model);
            model.object3D.visible = false;
            model.dataset.name = fish.name;
            Object.assign(model.style, {
                scale: fish.scale
            })
            document.querySelector("#models").append(model);
        });

        document.addEventListener('DOMContentLoaded', function () {
            App.selected = 0;
        });
    </script>

</body>

</html>